{"name":"ArcSight SOP CheckList","tagline":"Rudiment ArcSight SOP Checklist ","body":"### Connector Sensor Tier Health Checks\r\n* [Current ArcSight Smart Connector Supported Devices ](http://www.hpenterprisesecurity.com/collateral/HP_ArcSight_Supported_Products.pdf)\r\n* UP/Down Check \r\n* Connector Event Rate Check \r\n* Cache Check \r\n* Log Check \r\n* Configuration Check \r\n\r\n### Connector Appliance Management Tier Health Checks \r\n* CPU & Memory Check \r\n* Network Settings Check \r\n* Configuration Backup Check \r\n\r\n### Enterprise Security Manager(ESM) Application Tier Health Checks \r\n* Event Throughput Dashboard Check \r\n* Current Event Sources Dashboard Check \r\n* CPU/Memory Utilization Check \r\n* Active/Session List Utilization Check \r\n* Rules Engine Check \r\n* Event Persistence Performance Check(Event Insertion Rate)\r\n* Error Check \r\n* Scheduled Task Check \r\n* server.properties Check \r\n* Agent & Console Threads Check \r\n\r\n### Oracle Data Tier Health Checks \r\n* DBCheck & Oracle RDA\r\n* Database Performance Statistics Dashboard \r\n* Partition Check\r\n* Trend Job Check \r\n* Hardware and Operating System Check \r\n* CPU & Memory Utilization Check \r\n* Oracle Version and Patch Level Check \r\n* Oracle Alert Log Check \r\n* Oracle Memory Parameters Check \r\n* ESM Database Storage Check \r\n\r\n### HP/ArcSight Support URL Reference\r\n* [Documentation](https://protect724.hp.com/community/arcsight/productdocs)\r\n* [Software/Patches](https://h20575.www2.hp.com/usbportal/softwareupdate.do)\r\n* [Knowledge Base](http://support.openview.hp.com/selfsolve/documents)\r\n* [Support Center](http://support.openview.hp.com/casemanager/incident-index)\r\n\r\n### Procedure to TroubleShoot ESM State Up/Down\r\n\r\n```\r\nssh arcsight@arcsight_esm \r\nsudo su - \r\nlsof -i TCP:1521\r\n```\r\n\r\n* Note if there is no **ESTABLISHED** communication with **Oracle**\r\n\r\n```\r\n/etc/init.d/./arcsight_manager stop; tail -f /opt/arcsight/manager/manager-5.5/logs/default/server.std.log\r\n/etc/init.d/./arcsight_manager start; tail -f /opt/arcsight/manager/manager-5.5/logs/default/server.std.log\r\n```\r\n\r\n### Stop|Start ArcSight Enterprise Security Manager Gracefully \r\n\r\n* Note ensure you are the **arcsight** user. \r\n\r\n* To gracefully stop the ArcSight ESM\r\n\r\n```\r\n/etc/init.d/./arcsight_manager stop\r\n```\r\n\r\n* To gracefully start the ArcSight ESM\r\n\r\n```\r\n/etc/init.d/./arcsight_manager start\r\n```\r\n\r\n### Startup ArcSight Enterprise Security Manager Via Commandline for Troubleshooting Purposes **ONLY**\r\n\r\n* Note ensure you are the **arcsight** user. The **&** backgrounds the process. \r\n\r\n```\r\ncd /opt/arcsight/manager/manager-5.5/bin/\r\n./arcsight manager &\r\n```\r\n\r\n### Useful Rudiment Linux Command Line Strings \r\n\r\n* From the ArcSight ESM Determine State of ESM to Oracle Communications - Private Network Interface\r\n\r\n```\r\nlsof -i TCP:1521\r\ntcpdump -i bond1.114 dst port 1521\r\n```\r\n\r\n* From ArcSight ESM Determine State of Smart Connector or ArcSight Loggers Feeding - Public Network Interface \r\n\r\n```\r\nlsof -i TCP:8443 \r\ntcpdump â€“I bond0:244:0 dst port 8443 \r\n```\r\n\r\n\r\n### Important ArcSight $PATH Locations \r\n\r\n* ArcSight Manager $HOME \r\n\r\n```\r\n/opt/arcsight/manager/manager-5.5\r\n```\r\n\r\n* ArcSight DB HOME\r\n\r\n```\r\n/opt/arcsight/db/db-5.5\r\n```\r\n\r\n* Oracle 11g $HOME\r\n\r\n```\r\n/opt/oracle/OraHome11g\r\n```\r\n\r\n### Important ArcSight $LOG Locations \r\n\r\n* ArcSight Manager $LOGS\r\n\r\n```\r\n/opt/arcsight/manager/manager-5.5/logs/default/server.std.log \r\n```\r\n\r\n* Oracle 11g Alert $LOG\r\n\r\n```\r\n/opt/oracle/OraHome11g/diag/rdbms/arcsight/arcsight/trace/alert_arcsight.log\r\n```\r\n\r\n### Some Troubleshooting Fundamentals and Solutions\r\n\r\n\r\n#### Tailing ESM Exceptions\r\n\r\n```\r\nssh arcsight@esm_node \r\ncd $ARCSIGHT_MANAGER_HOME/logs/default\r\ntail -f server.std.log | ../../bin/./arcsight exceptions\r\n```\r\n\r\n\r\n#### Detecting Excessive IOWAIT \r\n\r\n* SSH to the Oracle node within the ArcSight Architecture \r\n\r\n```\r\niostat 5 -c\r\n```\r\n\r\n* IOWAIT of 5% or less is fine \r\n* IOWAIT greater than 5% is bad\r\n\r\n\r\n#### How to determine the IP Address of the Oracle node within Veritas Cluster\r\n\r\n* The Oracle node IP address will be the IP Address that the ESM IP Address is connected to on TCP Port 1521, unless Oracle listener has been configured to listen on a non-standard TCP Port. \r\n\r\n```\r\nssh arcsight@esm_node \r\nnetstat -an | grep 1521 | grep ESTABLISHED\r\n10.0.0.3:20783   10.0.0.4:1521   ESTABLISHED\r\n```\r\n\r\n\r\n#### How to reset the ArcSight ESM admin password if forgotten or disabled/locked out\r\n\r\n* SSH to the ESM node within your ArcSight architecture\r\n* NOTE: If your ESM is running under the non-privledged user account 'arcsight' ensure you are the arcsight user while performing the following procedure. \r\n\r\n```\r\nssh arcsight@esm_node \r\ncd $ARCSIGHT_MANAGER_HOME/bin/scripts \r\n../arcsight resetpwd\r\nadmin\r\nENTER NEW PASSWD\r\nREPEAT\r\nYes\r\n```\r\n\r\n* Now you should be able to login to the ArcSight Console with the 'admin' user account utilizing the new password\r\n\r\n\r\n\r\n#### Connectivity between the ESM and Oracle data tier lost \r\n\r\n* The ESM will generate an **ERROR** event within $ARCSIGHT_HOME/logs/default/server.std.log\r\n\r\n```\r\nERROR:java.sql.SQLException: Got minus one from a read call\r\n```\r\n\r\n* Perform the following troubleshooting actions from the Oracle node of the ESM Architecture \r\nNOTE: utilize the **oracle** user account!!\r\n\r\n```\r\nsqlplus '/ as sysdba' \r\nSQL> select instance_name, status, from gv$instance;\r\n```\r\n\r\n* Next Check the status of the Oracle listener to ensure that the listener is in state **LISTENING**\r\n\r\n```\r\ncd $ARCSIGHT_DB_HOME/db/bin\r\n./arcdbutil lsnrctl status\r\n```\r\n\r\n* From the Oracle node of the ESM Architecture check **sqlnet.ora** ensure TCP.INVITED_NODES parameter allows the ESM hostname\r\n\r\n```\r\ncat $ORACLE_HOME/OraHome11g/network/admin/sqlnet.ora\r\n```\r\n\r\n* Next from the ESM system \r\n\r\n```\r\ntelnet oracle.hostname.com 1521\r\n```\r\n\r\n#### Determine the Startup Time of the Oracle ArcSight database instance \r\nNOTE: As the **oracle** user\r\n\r\n```\r\nselect to_char(startup_time, 'HH24:MI DD-MON-YY') \"Startup Time\"\r\nfrom v$instance\r\n/\r\n```\r\n\r\n#### Determine from SQL current Database size and available free space\r\nNOTE: As the **oracle** user copy and past on the Oracle node the following script and name the file \r\n**check_current_free.sql**\r\n[check_current_free.sql](https://gist.github.com/alienone/8031362/raw/c79fe2cb39122fc58e437690eda68a1f002b6d54/check_current_free.sql)\r\n\r\n```\r\nvim check_current_free.sql\r\nI #(INSERT)\r\n:wq! #(WRITE AND QUIT FILE)\r\n\r\nsqlplus '/ as sysdba'\r\n!ls \r\n@check_current_free.sql\r\n```\r\n\r\n#### Determine available space for each table space within a given Oracle DB instance \r\nNOTE: As the **oracle** user - download and save the following script: [free_space_table.sql](https://gist.github.com/alienone/8031427/raw/73943d970cace46d357966055d77b2cc5c9fd95a/free_space_table.sql)\r\n\r\n```\r\nvim check_current_free.sql\r\nI #(INSERT)\r\n:wq! #(WRITE AND QUIT FILE)\r\n\r\nsqlplus '/ as sysdba'\r\n!ls \r\n@free_space_table.sql\r\n``` \r\n\r\n#### Manual Java KeyTool - Keys - Certificate Signing Request - Certificate Chain Trust Import - CA Root Import \r\n```\r\ncd /apps/arcsight/manager/jre/bin\r\n\r\ncp ../../config/jetty/keystore ../../config/jetty/keystore.bak.`date +'%m%d%Y'`\r\n\r\ncp ../../config/jetty/keystore ../../config/jetty/keystore.request\r\n\r\n./keytool -genkeypair -keyalg rsa -keysize 2048 -dname \"CN=<your-fqdn>, OU=<your-org>, O=<your-org-unit>, L=<your-city>, S=<your-state>, C=<your-country-code>\" -validity 1095 -keystore /apps/arcsight/manager/config/jetty/keystore.request -storepass <your-password> -alias <your-alias>\r\n\r\n./keytool -certreq -alias <yourpassword> -keystore /apps/arcsight/manager/config/jetty/keystore.request -storepass <your-password> -file arcsight.csr\r\n\r\n./keytool -import -trustcacerts -file certificate.p12 -keystore /apps/arcsight/manager/jre/lib/security/cacerts -storepass <yourpassword> -alias <your-alias>\r\n\r\n./keytool -import -alias <your alias> -file ca_signed.crt -keystore /apps/arcsight/manager/config/jetty/keystore.request -storepass <yourpassword> \r\n\r\ncp ../../config/jetty/keystore.request ../../config/jetty/keystore \r\n\r\n./keytool -list -keystore /apps/arcsight/manager/config/jetty/keystore.request -alias <youralias>\r\n```\r\n\r\n####Performance Tuning ArcSight 6.5.1 \r\n\r\n* Disable Red Hat kernel enabled Transparent Huge Pages \r\n\r\n```\r\necho never > /sys/kernel/mm/redhat_transparent_hugepage/enabled\r\n```\r\n\r\n* Set /etc/sysctl parameters for ESM to the following, ensure that these parameters are not already set to other values \r\n\r\n```\r\nkernel.shmmax = 16642998272\r\nkernel.shmall = 4160749568\r\nvm.swappiness=0\r\nvm.hugetlb_shm_group=500\r\nvm.nr_hugepages=7168\r\nvm.min_free_kbytes=131072\r\nvm.dirty_ratio=8\r\nvm.dirty_background_ratio=4\r\n```\r\n\r\n* Add the following ulimit values for the arcsight user to  **/etc/security/limits.d/90-nproc.conf** and to **/etc/security/limits.conf**\r\n\r\n```\r\n@arcsight soft memlock 16252928\r\n@arcsight hard memlock 16252928\r\n```\r\n\r\n* Edit  **/opt/arcsight/logger/current/arcsight/logger/bin/scripts/servers.sh**\r\n\r\n```\r\nARCSIGHT_JVM_OPTIONS=\"-verbose:gc -Xms256m -Xmx1536m -XX:+UseLargePages -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=utf-8 \"\r\n```\r\n\r\n* Edit **/opt/arcsight/manager/config/server.wrapper.conf**\r\n\r\n```\r\nwrapper.java.additional.12=-XX:+UseLargePages\r\nwrapper.java.additional.13=-XX:ReservedCodeCacheSize=256m\r\n\r\n```\r\n\r\n* Edit /opt/arcsight/logger/data/mysql/my.cnf\r\n```\r\n[mysqld]\r\nlarge-pages\r\nkey_buffer_size=1G\r\nsort_temp_limit = 50G\r\ninnodb_buffer_pool_size = 5G\r\n``\r\n\r\n-\t**REBOOT THE SYSTEM**\r\n```\r\ninit 6\r\n```\r\n\r\n####Increase the number of ArcSight ESM Log Files \r\n\r\n* Edit **server.properties**\r\n```\r\nlog.channel.file.property.maxbackupindex=100\r\n```\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}
<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>ArcSight SOP CheckList by alienone</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>ArcSight SOP CheckList</h1>
        <h2>Rudiment ArcSight SOP Checklist </h2>
        <a href="https://github.com/alienone/ArcSightSOPS" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h3>
<a id="connector-sensor-tier-health-checks" class="anchor" href="#connector-sensor-tier-health-checks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connector Sensor Tier Health Checks</h3>

<ul>
<li><a href="http://www.hpenterprisesecurity.com/collateral/HP_ArcSight_Supported_Products.pdf">Current ArcSight Smart Connector Supported Devices </a></li>
<li>UP/Down Check </li>
<li>Connector Event Rate Check </li>
<li>Cache Check </li>
<li>Log Check </li>
<li>Configuration Check </li>
</ul>

<h3>
<a id="connector-appliance-management-tier-health-checks" class="anchor" href="#connector-appliance-management-tier-health-checks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connector Appliance Management Tier Health Checks</h3>

<ul>
<li>CPU &amp; Memory Check </li>
<li>Network Settings Check </li>
<li>Configuration Backup Check </li>
</ul>

<h3>
<a id="enterprise-security-manageresm-application-tier-health-checks" class="anchor" href="#enterprise-security-manageresm-application-tier-health-checks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enterprise Security Manager(ESM) Application Tier Health Checks</h3>

<ul>
<li>Event Throughput Dashboard Check </li>
<li>Current Event Sources Dashboard Check </li>
<li>CPU/Memory Utilization Check </li>
<li>Active/Session List Utilization Check </li>
<li>Rules Engine Check </li>
<li>Event Persistence Performance Check(Event Insertion Rate)</li>
<li>Error Check </li>
<li>Scheduled Task Check </li>
<li>server.properties Check </li>
<li>Agent &amp; Console Threads Check </li>
</ul>

<h3>
<a id="oracle-data-tier-health-checks" class="anchor" href="#oracle-data-tier-health-checks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Oracle Data Tier Health Checks</h3>

<ul>
<li>DBCheck &amp; Oracle RDA</li>
<li>Database Performance Statistics Dashboard </li>
<li>Partition Check</li>
<li>Trend Job Check </li>
<li>Hardware and Operating System Check </li>
<li>CPU &amp; Memory Utilization Check </li>
<li>Oracle Version and Patch Level Check </li>
<li>Oracle Alert Log Check </li>
<li>Oracle Memory Parameters Check </li>
<li>ESM Database Storage Check </li>
</ul>

<h3>
<a id="hparcsight-support-url-reference" class="anchor" href="#hparcsight-support-url-reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>HP/ArcSight Support URL Reference</h3>

<ul>
<li><a href="https://protect724.hp.com/community/arcsight/productdocs">Documentation</a></li>
<li><a href="https://h20575.www2.hp.com/usbportal/softwareupdate.do">Software/Patches</a></li>
<li><a href="http://support.openview.hp.com/selfsolve/documents">Knowledge Base</a></li>
<li><a href="http://support.openview.hp.com/casemanager/incident-index">Support Center</a></li>
</ul>

<h3>
<a id="procedure-to-troubleshoot-esm-state-updown" class="anchor" href="#procedure-to-troubleshoot-esm-state-updown" aria-hidden="true"><span class="octicon octicon-link"></span></a>Procedure to TroubleShoot ESM State Up/Down</h3>

<pre><code>ssh arcsight@arcsight_esm 
sudo su - 
lsof -i TCP:1521
</code></pre>

<ul>
<li>Note if there is no <strong>ESTABLISHED</strong> communication with <strong>Oracle</strong>
</li>
</ul>

<pre><code>/etc/init.d/./arcsight_manager stop; tail -f /opt/arcsight/manager/manager-5.5/logs/default/server.std.log
/etc/init.d/./arcsight_manager start; tail -f /opt/arcsight/manager/manager-5.5/logs/default/server.std.log
</code></pre>

<h3>
<a id="stopstart-arcsight-enterprise-security-manager-gracefully" class="anchor" href="#stopstart-arcsight-enterprise-security-manager-gracefully" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stop|Start ArcSight Enterprise Security Manager Gracefully</h3>

<ul>
<li><p>Note ensure you are the <strong>arcsight</strong> user. </p></li>
<li><p>To gracefully stop the ArcSight ESM</p></li>
</ul>

<pre><code>/etc/init.d/./arcsight_manager stop
</code></pre>

<ul>
<li>To gracefully start the ArcSight ESM</li>
</ul>

<pre><code>/etc/init.d/./arcsight_manager start
</code></pre>

<h3>
<a id="startup-arcsight-enterprise-security-manager-via-commandline-for-troubleshooting-purposes-only" class="anchor" href="#startup-arcsight-enterprise-security-manager-via-commandline-for-troubleshooting-purposes-only" aria-hidden="true"><span class="octicon octicon-link"></span></a>Startup ArcSight Enterprise Security Manager Via Commandline for Troubleshooting Purposes <strong>ONLY</strong>
</h3>

<ul>
<li>Note ensure you are the <strong>arcsight</strong> user. The <strong>&amp;</strong> backgrounds the process. </li>
</ul>

<pre><code>cd /opt/arcsight/manager/manager-5.5/bin/
./arcsight manager &amp;
</code></pre>

<h3>
<a id="useful-rudiment-linux-command-line-strings" class="anchor" href="#useful-rudiment-linux-command-line-strings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Useful Rudiment Linux Command Line Strings</h3>

<ul>
<li>From the ArcSight ESM Determine State of ESM to Oracle Communications - Private Network Interface</li>
</ul>

<pre><code>lsof -i TCP:1521
tcpdump -i bond1.114 dst port 1521
</code></pre>

<ul>
<li>From ArcSight ESM Determine State of Smart Connector or ArcSight Loggers Feeding - Public Network Interface </li>
</ul>

<pre><code>lsof -i TCP:8443 
tcpdump â€“I bond0:244:0 dst port 8443 
</code></pre>

<h3>
<a id="important-arcsight-path-locations" class="anchor" href="#important-arcsight-path-locations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Important ArcSight $PATH Locations</h3>

<ul>
<li>ArcSight Manager $HOME </li>
</ul>

<pre><code>/opt/arcsight/manager/manager-5.5
</code></pre>

<ul>
<li>ArcSight DB HOME</li>
</ul>

<pre><code>/opt/arcsight/db/db-5.5
</code></pre>

<ul>
<li>Oracle 11g $HOME</li>
</ul>

<pre><code>/opt/oracle/OraHome11g
</code></pre>

<h3>
<a id="important-arcsight-log-locations" class="anchor" href="#important-arcsight-log-locations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Important ArcSight $LOG Locations</h3>

<ul>
<li>ArcSight Manager $LOGS</li>
</ul>

<pre><code>/opt/arcsight/manager/manager-5.5/logs/default/server.std.log 
</code></pre>

<ul>
<li>Oracle 11g Alert $LOG</li>
</ul>

<pre><code>/opt/oracle/OraHome11g/diag/rdbms/arcsight/arcsight/trace/alert_arcsight.log
</code></pre>

<h3>
<a id="some-troubleshooting-fundamentals-and-solutions" class="anchor" href="#some-troubleshooting-fundamentals-and-solutions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Some Troubleshooting Fundamentals and Solutions</h3>

<h4>
<a id="tailing-esm-exceptions" class="anchor" href="#tailing-esm-exceptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tailing ESM Exceptions</h4>

<pre><code>ssh arcsight@esm_node 
cd $ARCSIGHT_MANAGER_HOME/logs/default
tail -f server.std.log | ../../bin/./arcsight exceptions
</code></pre>

<h4>
<a id="detecting-excessive-iowait" class="anchor" href="#detecting-excessive-iowait" aria-hidden="true"><span class="octicon octicon-link"></span></a>Detecting Excessive IOWAIT</h4>

<ul>
<li>SSH to the Oracle node within the ArcSight Architecture </li>
</ul>

<pre><code>iostat 5 -c
</code></pre>

<ul>
<li>IOWAIT of 5% or less is fine </li>
<li>IOWAIT greater than 5% is bad</li>
</ul>

<h4>
<a id="how-to-determine-the-ip-address-of-the-oracle-node-within-veritas-cluster" class="anchor" href="#how-to-determine-the-ip-address-of-the-oracle-node-within-veritas-cluster" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to determine the IP Address of the Oracle node within Veritas Cluster</h4>

<ul>
<li>The Oracle node IP address will be the IP Address that the ESM IP Address is connected to on TCP Port 1521, unless Oracle listener has been configured to listen on a non-standard TCP Port. </li>
</ul>

<pre><code>ssh arcsight@esm_node 
netstat -an | grep 1521 | grep ESTABLISHED
10.0.0.3:20783   10.0.0.4:1521   ESTABLISHED
</code></pre>

<h4>
<a id="how-to-reset-the-arcsight-esm-admin-password-if-forgotten-or-disabledlocked-out" class="anchor" href="#how-to-reset-the-arcsight-esm-admin-password-if-forgotten-or-disabledlocked-out" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to reset the ArcSight ESM admin password if forgotten or disabled/locked out</h4>

<ul>
<li>SSH to the ESM node within your ArcSight architecture</li>
<li>NOTE: If your ESM is running under the non-privledged user account 'arcsight' ensure you are the arcsight user while performing the following procedure. </li>
</ul>

<pre><code>ssh arcsight@esm_node 
cd $ARCSIGHT_MANAGER_HOME/bin/scripts 
../arcsight resetpwd
admin
ENTER NEW PASSWD
REPEAT
Yes
</code></pre>

<ul>
<li>Now you should be able to login to the ArcSight Console with the 'admin' user account utilizing the new password</li>
</ul>

<h4>
<a id="connectivity-between-the-esm-and-oracle-data-tier-lost" class="anchor" href="#connectivity-between-the-esm-and-oracle-data-tier-lost" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connectivity between the ESM and Oracle data tier lost</h4>

<ul>
<li>The ESM will generate an <strong>ERROR</strong> event within $ARCSIGHT_HOME/logs/default/server.std.log</li>
</ul>

<pre><code>ERROR:java.sql.SQLException: Got minus one from a read call
</code></pre>

<ul>
<li>Perform the following troubleshooting actions from the Oracle node of the ESM Architecture 
NOTE: utilize the <strong>oracle</strong> user account!!</li>
</ul>

<pre><code>sqlplus '/ as sysdba' 
SQL&gt; select instance_name, status, from gv$instance;
</code></pre>

<ul>
<li>Next Check the status of the Oracle listener to ensure that the listener is in state <strong>LISTENING</strong>
</li>
</ul>

<pre><code>cd $ARCSIGHT_DB_HOME/db/bin
./arcdbutil lsnrctl status
</code></pre>

<ul>
<li>From the Oracle node of the ESM Architecture check <strong>sqlnet.ora</strong> ensure TCP.INVITED_NODES parameter allows the ESM hostname</li>
</ul>

<pre><code>cat $ORACLE_HOME/OraHome11g/network/admin/sqlnet.ora
</code></pre>

<ul>
<li>Next from the ESM system </li>
</ul>

<pre><code>telnet oracle.hostname.com 1521
</code></pre>

<h4>
<a id="determine-the-startup-time-of-the-oracle-arcsight-database-instance" class="anchor" href="#determine-the-startup-time-of-the-oracle-arcsight-database-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Determine the Startup Time of the Oracle ArcSight database instance</h4>

<p>NOTE: As the <strong>oracle</strong> user</p>

<pre><code>select to_char(startup_time, 'HH24:MI DD-MON-YY') "Startup Time"
from v$instance
/
</code></pre>

<h4>
<a id="determine-from-sql-current-database-size-and-available-free-space" class="anchor" href="#determine-from-sql-current-database-size-and-available-free-space" aria-hidden="true"><span class="octicon octicon-link"></span></a>Determine from SQL current Database size and available free space</h4>

<p>NOTE: As the <strong>oracle</strong> user copy and past on the Oracle node the following script and name the file 
<strong>check_current_free.sql</strong>
<a href="https://gist.github.com/alienone/8031362/raw/c79fe2cb39122fc58e437690eda68a1f002b6d54/check_current_free.sql">check_current_free.sql</a></p>

<pre><code>vim check_current_free.sql
I #(INSERT)
:wq! #(WRITE AND QUIT FILE)

sqlplus '/ as sysdba'
!ls 
@check_current_free.sql
</code></pre>

<h4>
<a id="determine-available-space-for-each-table-space-within-a-given-oracle-db-instance" class="anchor" href="#determine-available-space-for-each-table-space-within-a-given-oracle-db-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Determine available space for each table space within a given Oracle DB instance</h4>

<p>NOTE: As the <strong>oracle</strong> user - download and save the following script: <a href="https://gist.github.com/alienone/8031427/raw/73943d970cace46d357966055d77b2cc5c9fd95a/free_space_table.sql">free_space_table.sql</a></p>

<pre><code>vim check_current_free.sql
I #(INSERT)
:wq! #(WRITE AND QUIT FILE)

sqlplus '/ as sysdba'
!ls 
@free_space_table.sql
</code></pre>

<h4>
<a id="manual-java-keytool---keys---certificate-signing-request---certificate-chain-trust-import---ca-root-import" class="anchor" href="#manual-java-keytool---keys---certificate-signing-request---certificate-chain-trust-import---ca-root-import" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manual Java KeyTool - Keys - Certificate Signing Request - Certificate Chain Trust Import - CA Root Import</h4>

<pre><code>cd /apps/arcsight/manager/jre/bin

cp ../../config/jetty/keystore ../../config/jetty/keystore.bak.`date +'%m%d%Y'`

cp ../../config/jetty/keystore ../../config/jetty/keystore.request

./keytool -genkeypair -keyalg rsa -keysize 2048 -dname "CN=&lt;your-fqdn&gt;, OU=&lt;your-org&gt;, O=&lt;your-org-unit&gt;, L=&lt;your-city&gt;, S=&lt;your-state&gt;, C=&lt;your-country-code&gt;" -validity 1095 -keystore /apps/arcsight/manager/config/jetty/keystore.request -storepass &lt;your-password&gt; -alias &lt;your-alias&gt;

./keytool -certreq -alias &lt;yourpassword&gt; -keystore /apps/arcsight/manager/config/jetty/keystore.request -storepass &lt;your-password&gt; -file arcsight.csr

./keytool -import -trustcacerts -file certificate.p12 -keystore /apps/arcsight/manager/jre/lib/security/cacerts -storepass &lt;yourpassword&gt; -alias &lt;your-alias&gt;

./keytool -import -alias &lt;your alias&gt; -file ca_signed.crt -keystore /apps/arcsight/manager/config/jetty/keystore.request -storepass &lt;yourpassword&gt; 

cp ../../config/jetty/keystore.request ../../config/jetty/keystore 

./keytool -list -keystore /apps/arcsight/manager/config/jetty/keystore.request -alias &lt;youralias&gt;
</code></pre>

<h4>
<a id="performance-tuning-arcsight-651" class="anchor" href="#performance-tuning-arcsight-651" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance Tuning ArcSight 6.5.1</h4>

<ul>
<li>Disable Red Hat kernel enabled Transparent Huge Pages </li>
</ul>

<pre><code>echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/enabled
</code></pre>

<ul>
<li>Set /etc/sysctl parameters for ESM to the following, ensure that these parameters are not already set to other values </li>
</ul>

<pre><code>kernel.shmmax = 16642998272
kernel.shmall = 4160749568
vm.swappiness=0
vm.hugetlb_shm_group=500
vm.nr_hugepages=7168
vm.min_free_kbytes=131072
vm.dirty_ratio=8
vm.dirty_background_ratio=4
</code></pre>

<ul>
<li>Add the following ulimit values for the arcsight user to  <strong>/etc/security/limits.d/90-nproc.conf</strong> and to <strong>/etc/security/limits.conf</strong>
</li>
</ul>

<pre><code>@arcsight soft memlock 16252928
@arcsight hard memlock 16252928
</code></pre>

<ul>
<li>Edit  <strong>/opt/arcsight/logger/current/arcsight/logger/bin/scripts/servers.sh</strong>
</li>
</ul>

<pre><code>ARCSIGHT_JVM_OPTIONS="-verbose:gc -Xms256m -Xmx1536m -XX:+UseLargePages -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=utf-8 "
</code></pre>

<ul>
<li>Edit <strong>/opt/arcsight/manager/config/server.wrapper.conf</strong>
</li>
</ul>

<pre><code>wrapper.java.additional.12=-XX:+UseLargePages
wrapper.java.additional.13=-XX:ReservedCodeCacheSize=256m

</code></pre>

<ul>
<li>Edit /opt/arcsight/logger/data/mysql/my.cnf</li>
</ul>

<pre><code>[mysqld]
large-pages
key_buffer_size=1G
sort_temp_limit = 50G
innodb_buffer_pool_size = 5G
</code></pre>

<ul>
<li>  <strong>REBOOT THE SYSTEM</strong>
</li>
</ul>

<pre><code>init 6
</code></pre>

<h4>
<a id="increase-the-number-of-arcsight-esm-log-files" class="anchor" href="#increase-the-number-of-arcsight-esm-log-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Increase the number of ArcSight ESM Log Files</h4>

<ul>
<li>Edit <strong>server.properties</strong>
</li>
</ul>

<pre><code>log.channel.file.property.maxbackupindex=100
</code></pre>

<h4>
<a id="fixing-serializationexception-error-problem-set-impacts-all-versions-of-as-sc-to-current-706" class="anchor" href="#fixing-serializationexception-error-problem-set-impacts-all-versions-of-as-sc-to-current-706" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fixing SerializationException Error Problem Set Impacts all versions of AS SC to current 7.0.6</h4>

<ul>
<li>Delete any cached events from the smart connector cache under $CONNECTOR_HOME/user/agent/agentdata</li>
<li>Add the following parameters to a given smart connector agent.properties file</li>
</ul>

<pre><code>serializer.check.string.bytes=true
size.use.utf8.bytes=true
</code></pre>

<ul>
<li>Restart the smart connector </li>
</ul>

<h4>
<a id="logfu-set-jvm-memory" class="anchor" href="#logfu-set-jvm-memory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logfu Set JVM Memory</h4>

<pre><code>ARCSIGHT_JVM_OPTION=-Xmx1024m
</code></pre>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/alienone/ArcSightSOPS/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/alienone/ArcSightSOPS/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/alienone/ArcSightSOPS"></a> is maintained by <a href="https://github.com/alienone">alienone</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
